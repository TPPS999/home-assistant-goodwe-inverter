get_parameter:
  name: Get inverter configuration parameter
  description: Read inverter configuration parameter and store it in helper entity
  fields:
    device_id:
      name: Inverter device
      description: ID of the inverter device
      required: true
      selector:
        device:
          integration: goodwe
    parameter:
      name: Parameter
      description: Name of the inverter parameter
      required: true
      selector:
        text:
      example: 'battery_charge_current'
    entity_id:
      name: Helper entity
      description: Entity where to store the parameter value
      required: true
      selector:
        entity:
          domain:
            - input_number
            - input_text
set_parameter:
  name: Set inverter configuration parameter - EXPERIMENTAL
  description: BEWARE !!! Improper use may cause damage !
  fields:
    device_id:
      name: Inverter device
      description: ID of the inverter device
      required: true
      selector:
        device:
          integration: goodwe
    parameter:
      name: Parameter
      description: Name of the inverter parameter
      required: true
      selector:
        text:
      example: 'battery_charge_current'
    value:
      name: Value
      description: Value of the parameter to set
      example: '20'
      required: true
      selector:
        object:

set_neg_price_plan:
  name: Set negative price plan
  description: |
    Write negative electric price plan registers immediately.
    Provide either pre-built masks (6 integers each) OR price lists with threshold/flip options.

    For price optimizer integrations: call this service with *_tomorrow_masks to set tomorrow's plan.
    GoodWe integration handles midnight rollover automatically (tomorrow â†’ today at 00:00:30).
  fields:
    device_id:
      name: Inverter device
      description: ID of the inverter device
      required: true
      selector:
        device:
          integration: goodwe
    neg_price_enable:
      name: Enable negative price plan
      description: Enable or disable the negative price plan feature on the inverter
      required: false
      selector:
        boolean:
    sell_today_masks:
      name: Sell today masks (direct)
      description: "List of 6 integers (U16 registers) for sell today plan. Alternative to sell_today_prices."
      required: false
      selector:
        object:
    sell_tomorrow_masks:
      name: Sell tomorrow masks (direct)
      description: "List of 6 integers (U16 registers) for sell tomorrow plan"
      required: false
      selector:
        object:
    buy_today_masks:
      name: Buy today masks (direct)
      description: "List of 6 integers (U16 registers) for buy today plan"
      required: false
      selector:
        object:
    buy_tomorrow_masks:
      name: Buy tomorrow masks (direct)
      description: "List of 6 integers (U16 registers) for buy tomorrow plan"
      required: false
      selector:
        object:
    sell_today_prices:
      name: Sell today prices (auto-build)
      description: "List of electricity sell prices for today. Masks will be built automatically using threshold/flip."
      required: false
      selector:
        object:
    sell_tomorrow_prices:
      name: Sell tomorrow prices (auto-build)
      description: List of electricity sell prices for tomorrow
      required: false
      selector:
        object:
    buy_today_prices:
      name: Buy today prices (auto-build)
      description: List of electricity buy prices for today
      required: false
      selector:
        object:
    buy_tomorrow_prices:
      name: Buy tomorrow prices (auto-build)
      description: List of electricity buy prices for tomorrow
      required: false
      selector:
        object:
    sell_threshold:
      name: Sell price threshold
      description: "Prices below this value are treated as negative (bit=1 in mask). Only used with *_prices."
      required: false
      default: 0.0
      selector:
        number:
          mode: box
          step: 0.001
    flip_sell:
      name: Flip sell mask
      description: "Invert the sell mask (bit=1 for prices >= threshold instead of < threshold). Only used with *_prices."
      required: false
      default: false
      selector:
        boolean:
    buy_threshold:
      name: Buy price threshold
      description: "Buy prices below this value are treated as favorable (bit=1 in mask). Only used with *_prices."
      required: false
      default: 0.0
      selector:
        number:
          mode: box
          step: 0.001
    flip_buy:
      name: Flip buy mask
      description: "Invert the buy mask. Only used with *_prices."
      required: false
      default: false
      selector:
        boolean:
    buy_switch:
      name: Buy switch mode
      description: "0: disabled, 1: charge battery only, 2: charge + allow positive sell"
      required: false
      selector:
        select:
          options:
            - label: Disabled
              value: '0'
            - label: Charge battery only
              value: '1'
            - label: Charge + positive sell
              value: '2'
    slot_minutes:
      name: Price slot duration (minutes)
      description: "Duration of each price entry in minutes (15, 30, or 60). Only used with *_prices."
      required: false
      default: 60
      selector:
        select:
          options:
            - label: 15 minutes
              value: '15'
            - label: 30 minutes
              value: '30'
            - label: 60 minutes (hourly)
              value: '60'
